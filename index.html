<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover, user-scalable=no"/>
  <title>竖屏躲星星</title>
  <style>
    :root { --bg1:#0b1020; --bg2:#131a33; --txt:#fff; }
    html,body { margin:0; padding:0; height:100%; background:var(--bg1); color:var(--txt); font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial,'PingFang SC','Hiragino Sans GB','Microsoft YaHei',sans-serif; }
    #wrap { position:fixed; inset:0; overflow:hidden; background: radial-gradient(ellipse at top, var(--bg2) 0%, var(--bg1) 60%); touch-action:none; }
    canvas { position:absolute; inset:0; width:100%; height:100%; display:block; }
    .hud { position:absolute; left:0; right:0; top:0; display:flex; justify-content:space-between; padding:10px 14px; z-index:5; font-weight:600; text-shadow:0 2px 8px rgba(0,0,0,.5);}
    .btn { background:rgba(255,255,255,.1); border:1px solid rgba(255,255,255,.2); color:#fff; border-radius:10px; padding:8px 12px; }
    .overlay { position:absolute; inset:0; display:none; align-items:center; justify-content:center; z-index:10; background:rgba(0,0,0,.35); backdrop-filter:blur(2px);}
    .overlay.show { display:flex; }
    .card { width:min(88vw,460px); background:rgba(20,26,48,.95); border:1px solid rgba(255,255,255,.12); border-radius:16px; padding:18px; text-align:center; }
    .title { font-size:22px; margin-bottom:10px; }
    .subtitle { opacity:.85; font-size:14px; margin-bottom:12px; }
    .actions { display:flex; gap:10px; justify-content:center; }
    .play { border:none; border-radius:12px; padding:12px 16px; font-size:16px; font-weight:700; background:linear-gradient(180deg,#ffd35a,#ff9b2f); color:#2a1500; }
    .rotate-tip { position:absolute; inset:0; display:none; align-items:center; justify-content:center; text-align:center; padding:20px; z-index:11; }
    .rotate-tip.show { display:flex; }
  </style>
</head>
<body>
<div id="wrap">
  <canvas id="c"></canvas>
  <div class="hud">
    <div>得分 <span id="score">0</span></div>
    <button class="btn" id="pause">暂停</button>
  </div>
  <div class="overlay show" id="start">
    <div class="card">
      <div class="title">竖屏躲星星</div>
      <div class="subtitle">用手指在屏幕任何位置左右滑动/拖动，小鸟会跟随移动（不会飞出屏幕）。电脑上用鼠标移动来模拟触控。</div>
      <div class="actions"><button class="play" id="playBtn">开始</button></div>
      <div style="font-size:12px;opacity:.8;margin-top:8px;">若无声或看不到按钮，请先点一下屏幕以解锁音频与控件。</div>
    </div>
  </div>
  <div class="overlay" id="gameover">
    <div class="card">
      <div class="title">游戏结束</div>
      <div class="subtitle">你的得分：<b id="final">0</b></div>
      <div class="actions"><button class="play" id="again">再来一局</button></div>
    </div>
  </div>
  <div class="rotate-tip" id="rotateTip">
    <div>
      <div style="font-size:26px;margin-bottom:8px;">请切换为竖屏</div>
      <div style="opacity:.8;">为了更好的体验，请把手机竖起来（Portrait）。</div>
    </div>
  </div>
</div>

<script>
  // ===== orientation guard (show tip if landscape) =====
  const rotateTip = document.getElementById('rotateTip');
  function checkOrientation() { rotateTip.classList.toggle('show', window.innerWidth > window.innerHeight); }
  window.addEventListener('resize', checkOrientation, {passive:true}); checkOrientation();

  // ===== canvas setup =====
  const cvs = document.getElementById('c');
  const ctx = cvs.getContext('2d', {alpha:false});
  let W=0,H=0,dpr=Math.max(1,Math.min(2,window.devicePixelRatio||1));
  function fit() { const r=cvs.getBoundingClientRect(); W=Math.floor(r.width*dpr); H=Math.floor(r.height*dpr); cvs.width=W; cvs.height=H; ctx.setTransform(dpr,0,0,dpr,0,0); }
  new ResizeObserver(fit).observe(cvs); fit();

  // ===== audio =====
  let audio=null; function unlockAudio(){ if(!audio){ const AC=window.AudioContext||window.webkitAudioContext; audio=new AC(); }}
  function beep(f=660,d=0.05,t='sine',g=0.04){ if(!audio) return; const t0=audio.currentTime; const o=audio.createOscillator(); const gn=audio.createGain(); o.type=t; o.frequency.value=f; gn.gain.value=g; gn.gain.exponentialRampToValueAtTime(0.0001, t0+d+0.02); o.connect(gn).connect(audio.destination); o.start(); o.stop(t0+d+0.03); }

  // ===== bird sprite image =====
  const birdImg = new Image();
  birdImg.src = "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjgiIGhlaWdodD0iOTYiIHZpZXdCb3g9IjAgMCAxMjggOTYiPgogIDxkZWZzPgogICAgPGxpbmVhckdyYWRpZW50IGlkPSJnIiB4MT0iMCIgeTE9IjAiIHgyPSIwIiB5Mj0iMSI+CiAgICAgIDxzdG9wIG9mZnNldD0iMCUiIHN0b3AtY29sb3I9IiNmZmUwNmEiLz4KICAgICAgPHN0b3Agb2Zmc2V0PSIxMDAlIiBzdG9wLWNvbG9yPSIjZmZiMjNhIi8+CiAgICA8L2xpbmVhckdyYWRpZW50PgogIDwvZGVmcz4KICA8ZWxsaXBzZSBjeD0iNTYiIGN5PSI1MiIgcng9IjQwIiByeT0iMzAiIGZpbGw9InVybCgjZykiLz4KICA8ZWxsaXBzZSBjeD0iNDYiIGN5PSI1OCIgcng9IjE4IiByeT0iMTIiIGZpbGw9IiNmZmQzNWEiLz4KICA8Y2lyY2xlIGN4PSI4MiIgY3k9IjQ0IiByPSIxOCIgZmlsbD0idXJsKCNnKSIvPgogIDxwb2x5Z29uIHBvaW50cz0iOTQsNDYgMTE0LDUyIDk0LDU4IiBmaWxsPSIjZmY3YTAwIi8+CiAgPGNpcmNsZSBjeD0iODYiIGN5PSI0MiIgcj0iNC4yIiBmaWxsPSIjMTcyMDMzIi8+CiAgPGVsbGlwc2UgY3g9IjQ4IiBjeT0iNTAiIHJ4PSIxMiIgcnk9IjgiIGZpbGw9IndoaXRlIiBvcGFjaXR5PSIwLjIiLz4KPC9zdmc+";
  const bird = { x: 100, y: 0, r: 18, targetX: 100 };

  // ===== game state =====
  const stars = [];
  const state = { running:false, paused:false, over:false, t:0, speed:2.2, spawn:900, last:0, score:0 };

  function rand(min,max){ return Math.random()*(max-min)+min; }

  // spawn waves, max 3 in a row
  function spawn() { 
    const max=3, cnt=1+Math.floor(Math.random()*max);
    const margin=24;
    const laneW=Math.max(50, Math.min(120, cvs.clientWidth/6));
    const lanes=Math.max(3, Math.floor(cvs.clientWidth/laneW));
    const used=new Set();
    for(let i=0;i<cnt;i++){
      let lane=Math.floor(Math.random()*lanes), guard=0;
      while(used.has(lane)&&guard++<10) lane=Math.floor(Math.random()*lanes);
      used.add(lane);
      const x = margin + lane*((cvs.clientWidth-2*margin)/lanes) + ((cvs.clientWidth-2*margin)/lanes)/2;
      const size=10+Math.floor(Math.random()*8);
      stars.push({ x, y:-size*2, size, vy: state.speed + Math.random()*1.5, rot: Math.random()*Math.PI, spin: (Math.random()*0.04-0.02) });
      beep(880,0.04,'triangle',0.03);
    }
  }

  // draw helpers
  function drawStar(x,y,r,rot){
    ctx.save();
    ctx.translate(x,y);
    ctx.rotate(rot);
    ctx.beginPath();
    for(let i=0;i<5;i++){
      const a=i*(Math.PI*2)/5 - Math.PI/2;
      const ox=Math.cos(a)*r, oy=Math.sin(a)*r;
      const ia=a+Math.PI/5;
      const ix=Math.cos(ia)*r*0.5, iy=Math.sin(ia)*r*0.5;
      if(i===0) ctx.moveTo(ox,oy); else ctx.lineTo(ox,oy);
      ctx.lineTo(ix,iy);
    }
    ctx.closePath();
    const g=ctx.createRadialGradient(0,0,r*0.1,0,0,r);
    g.addColorStop(0,'#ffe99a'); g.addColorStop(0.6,'#ffd158'); g.addColorStop(1,'#ff9c2f');
    ctx.fillStyle=g; ctx.fill();
    ctx.restore();
  }

  function drawBird(){
    const w=bird.r*2.6, h=bird.r*2;
    ctx.drawImage(birdImg, bird.x - w/2, bird.y - h/2, w, h);
  }

  function clamp(v,min,max){ return Math.max(min, Math.min(max, v)); }

  // input: touch anywhere; desktop mouse move/click
  let dragging=false;
  function toLocalX(e){ const r=cvs.getBoundingClientRect(); const x=(e.touches?e.touches[0].clientX:e.clientX)-r.left; return clamp(x, bird.r+4, r.width-bird.r-4); }
  function onDown(e){ unlockAudio(); dragging=true; bird.targetX=toLocalX(e); e.preventDefault(); }
  function onMove(e){ if(dragging) bird.targetX=toLocalX(e); }
  function onUp(){ dragging=false; }

  cvs.addEventListener('touchstart', onDown, {passive:false});
  cvs.addEventListener('touchmove', onMove, {passive:true});
  window.addEventListener('touchend', onUp, {passive:true});
  cvs.addEventListener('mousedown', onDown);
  window.addEventListener('mousemove', onMove);
  window.addEventListener('mouseup', onUp);

  window.addEventListener('keydown', (e)=>{ if(e.key===' ') togglePause(); if(e.key==='ArrowLeft') bird.targetX-=18; if(e.key==='ArrowRight') bird.targetX+=18; });

  // overlays
  const start = document.getElementById('start');
  const over = document.getElementById('gameover');
  const pauseBtn = document.getElementById('pause');
  const playBtn = document.getElementById('playBtn');
  const again = document.getElementById('again');
  const scoreEl = document.getElementById('score');
  const finalEl = document.getElementById('final');

  function hideAll(){ start.classList.remove('show'); over.classList.remove('show'); }
  function reset(){ state.running=true; state.paused=false; state.over=false; state.t=0; state.speed=2.2; state.spawn=900; state.last=0; state.score=0; stars.length=0; scoreEl.textContent='0'; bird.r=Math.max(16, Math.min(24, Math.floor(Math.min(cvs.clientWidth, cvs.clientHeight)/22))); bird.x=cvs.clientWidth/2; bird.targetX=bird.x; bird.y=cvs.clientHeight - bird.r*2.2; }

  playBtn.onclick = ()=>{ unlockAudio(); hideAll(); reset(); last=performance.now(); requestAnimationFrame(loop); }
  again.onclick = ()=>{ hideAll(); reset(); last=performance.now(); requestAnimationFrame(loop); }
  pauseBtn.onclick = ()=>{ if(!state.running||state.over) return; state.paused=!state.paused; pauseBtn.textContent = state.paused?'继续':'暂停'; if(!state.paused){ last=performance.now(); requestAnimationFrame(loop); } };

  // loop
  let last = performance.now();
  function loop(now){
    if(!state.running) return;
    const dt = Math.min(50, now-last); last=now;
    if(state.paused) return;

    state.t += dt;
    const newScore = Math.floor(state.t/1000);
    if(newScore!==state.score){ state.score=newScore; scoreEl.textContent=String(state.score); }

    if(state.t % 2000 < dt){ state.speed=Math.min(8, state.speed+0.15); state.spawn=Math.max(420, state.spawn-20); }
    if(now - state.last > state.spawn){ spawn(); state.last=now; }

    bird.x += (bird.targetX - bird.x)*0.25;

    ctx.clearRect(0,0,cvs.width,cvs.height);

    for(let i=stars.length-1;i>=0;i--){
      const s=stars[i];
      s.y += s.vy; s.rot += s.spin;
      drawStar(s.x, s.y, s.size, s.rot);
      if(s.y - s.size > cvs.height){ stars.splice(i,1); continue; }
      const bw = bird.r*2.2, bh = bird.r*1.7;
      const rx = bird.x - bw/2, ry = bird.y - bh/2, rw=bw, rh=bh;
      const cx=s.x, cy=s.y, cr=s.size*0.9;
      const clx = Math.max(rx, Math.min(cx, rx+rw));
      const cly = Math.max(ry, Math.min(cy, ry+rh));
      const dx=cx-clx, dy=cy-cly;
      if(dx*dx+dy*dy <= cr*cr){ hit(); break; }
    }

    ctx.save(); ctx.strokeStyle='rgba(255,255,255,.08)'; ctx.lineWidth=2;
    ctx.beginPath(); ctx.moveTo(0, bird.y + bird.r + 8); ctx.lineTo(cvs.width, bird.y + bird.r + 8); ctx.stroke(); ctx.restore();

    drawBird();

    if(state.running && !state.over) requestAnimationFrame(loop);
  }

  function hit(){
    state.over=true; state.running=false; beep(220,0.1,'square',0.06);
    setTimeout(()=>{ finalEl.textContent=state.score; over.classList.add('show'); }, 150);
  }

  document.addEventListener('visibilitychange', ()=>{ if(document.hidden){ if(state.running && !state.over && !state.paused) pauseBtn.click(); } });
</script>
</body>
</html>
update: portrait mobile touch control version
