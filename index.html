<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,viewport-fit=cover,user-scalable=no">
<title>竖屏躲星星 - 虚拟摇杆版</title>
<style>
html,body{margin:0;padding:0;height:100%;background:#0b1020;color:#fff;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,"PingFang SC","Hiragino Sans GB","Microsoft YaHei",sans-serif;touch-action:none;-webkit-user-select:none;user-select:none}
#wrap{position:fixed;inset:0;overflow:hidden;background:radial-gradient(ellipse at top,#131a33 0%,#0b1020 60%)}
canvas{position:absolute;inset:0;display:block}
.hud{position:absolute;left:0;right:0;top:0;display:flex;justify-content:space-between;padding:10px 14px;z-index:5;font-weight:600;text-shadow:0 2px 8px rgba(0,0,0,.5)}
.btn{background:rgba(255,255,255,.1);border:1px solid rgba(255,255,255,.2);color:#fff;border-radius:10px;padding:6px 10px}
.overlay{position:absolute;inset:0;display:none;align-items:center;justify-content:center;z-index:10;background:rgba(0,0,0,.35);backdrop-filter:blur(2px)}
.overlay.show{display:flex}
.card{width:min(88vw,460px);background:rgba(20,26,48,.95);border:1px solid rgba(255,255,255,.12);border-radius:16px;padding:18px;text-align:center}
.title{font-size:22px;margin-bottom:10px}
.subtitle{opacity:.85;font-size:14px;margin-bottom:12px}
.actions{display:flex;gap:10px;justify-content:center;flex-wrap:wrap}
.play{border:none;border-radius:12px;padding:10px 14px;font-size:16px;font-weight:700;background:linear-gradient(180deg,#ffd35a,#ff9b2f);color:#2a1500}
.shop-item{display:flex;justify-content:space-between;align-items:center;background:rgba(255,255,255,.05);padding:6px 10px;border-radius:8px;margin:6px 0}
.shop-btn{border:none;border-radius:8px;padding:4px 8px;background:#ffd35a;color:#2a1500;font-weight:600}
#joystick{position:absolute;width:100px;height:100px;margin-left:-50px;margin-top:-50px;border-radius:50%;border:2px solid rgba(255,255,255,.3);background:rgba(255,255,255,.05);display:none;z-index:6}
#stick{position:absolute;left:50%;top:50%;width:40px;height:40px;margin-left:-20px;margin-top:-20px;border-radius:50%;background:rgba(255,255,255,.5)}
</style>
</head>
<body>
<div id="wrap">
<canvas id="c"></canvas>
<div id="joystick"><div id="stick"></div></div>
<div class="hud"><div>得分 <span id="score">0</span></div><button class="btn" id="pause">暂停</button></div>

<div class="overlay show" id="start"><div class="card"><div class="title">竖屏躲星星</div><div class="subtitle">用虚拟摇杆控制小鸟在屏幕内自由移动</div><div class="actions"><button class="play" id="playBtn">开始</button></div></div></div>

<div class="overlay" id="gameover"><div class="card"><div class="title">游戏结束</div><div class="subtitle">得分：<b id="final">0</b></div><div class="actions"><button class="play" id="goHome">返回主页</button><button class="play" id="goShop">积分升级</button></div></div></div>

<div class="overlay" id="shop"><div class="card"><div class="title">积分升级</div><div class="subtitle">总积分：<b id="totalPoints">0</b></div>
<div class="shop-item"><span>复活 +1 (1000分,最多3次)</span><button class="shop-btn" data-type="revive">购买</button></div>
<div class="shop-item"><span>小鸟换色 (500分)</span><button class="shop-btn" data-type="color">购买</button></div>
<div class="actions"><button class="play" id="shopBack">返回主页</button></div></div></div>
</div>

<script>
const cvs=document.getElementById("c"),ctx=cvs.getContext("2d"),birdImg=new Image();
birdImg.src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjgiIGhlaWdodD0iOTYiIHZpZXdCb3g9IjAgMCAxMjggOTYiPjxkZWZzPjxsaW5lYXJHcmFkaWVudCBpZD0iZyIgeDE9IjAiIHkxPSIwIiB4Mj0iMCIgeTI9IjEiPjxzdG9wIG9mZnNldD0iMCUiIHN0b3AtY29sb3I9IiNmZmUwNmEiLz48c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiNmZmIyM2EiLz48L2xpbmVhckdyYWRpZW50PjwvZGVmcz48ZWxsaXBzZSBjeD0iNTYiIGN5PSI1MiIgcng9IjQwIiByeT0iMzAiIGZpbGw9InVybCgjZykiLz48ZWxsaXBzZSBjeD0iNDYiIGN5PSI1OCIgcng9IjE4IiByeT0iMTIiIGZpbGw9IiNmZmQzNWEiLz48Y2lyY2xlIGN4PSI4MiIgY3k9IjQ0IiByPSIxOCIgZmlsbD0idXJsKCNnKSIvPjxwb2x5Z29uIHBvaW50cz0iOTQsNDYgMTE0LDUyIDk0LDU4IiBmaWxsPSIjZmY3YTAwIi8+PGNpcmNsZSBjeD0iODYiIGN5PSI0MiIgcj0iNC4yIiBmaWxsPSIjMTcyMDMzIi8+PGVsbGlwc2UgY3g9IjQ4IiBjeT0iNTAiIHJ4PSIxMiIgcng9IjgiIGZpbGw9IndoaXRlIiBvcGFjaXR5PSIwLjIiLz48L3N2Zz4=";
let W,H,dpr=Math.max(1,Math.min(2,window.devicePixelRatio||1));
function fit(){const r=cvs.getBoundingClientRect();W=Math.floor(r.width*dpr);H=Math.floor(r.height*dpr);cvs.width=W;cvs.height=H;ctx.setTransform(dpr,0,0,dpr,0,0);}
new ResizeObserver(fit).observe(cvs);fit();
const bird={x:150,y:150,r:18,vx:0,vy:0},stars=[],state={running:false,paused:false,over:false,t:0,spawn:900,last:0,score:0,speed:2.2};
function clamp(v,min,max){return Math.max(min,Math.min(max,v));}
function spawn(){const cnt=1+Math.floor(Math.random()*3);for(let i=0;i<cnt;i++){const x=Math.random()*cvs.clientWidth;const s=10+Math.random()*10;stars.push({x,y:-s*2,size:s,vy:state.speed+Math.random()*1.5,rot:Math.random()*Math.PI,spin:Math.random()*0.04-0.02});}}
function drawStar(x,y,r,rot){ctx.save();ctx.translate(x,y);ctx.rotate(rot);ctx.beginPath();for(let i=0;i<5;i++){const a=i*(Math.PI*2)/5-Math.PI/2;const ox=Math.cos(a)*r,oy=Math.sin(a)*r;const ia=a+Math.PI/5;const ix=Math.cos(ia)*r*0.5,iy=Math.sin(ia)*r*0.5;if(i===0)ctx.moveTo(ox,oy);else ctx.lineTo(ox,oy);ctx.lineTo(ix,iy);}ctx.closePath();const g=ctx.createRadialGradient(0,0,r*0.1,0,0,r);g.addColorStop(0,"#ffe99a");g.addColorStop(0.6,"#ffd158");g.addColorStop(1,"#ff9c2f");ctx.fillStyle=g;ctx.fill();ctx.restore();}
function drawBird(){const w=bird.r*2.6,h=bird.r*2;ctx.drawImage(birdImg,bird.x-w/2,bird.y-h/2,w,h);}
let joyCenter=null;const joy=document.getElementById("joystick"),stick=document.getElementById("stick");
function onDown(e){const t=e.touches?e.touches[0]:e;joyCenter={x:t.clientX,y:t.clientY};joy.style.left=joyCenter.x+"px";joy.style.top=joyCenter.y+"px";joy.style.display="block";e.preventDefault();}
function onMove(e){if(!joyCenter)return;const t=e.touches?e.touches[0]:e;const dx=t.clientX-joyCenter.x,dy=t.clientY-joyCenter.y;const dist=Math.min(40,Math.hypot(dx,dy));const ang=Math.atan2(dy,dx);const nx=Math.cos(ang)*dist,ny=Math.sin(ang)*dist;stick.style.transform=`translate(${nx}px,${ny}px)`;bird.vx=nx*0.1;bird.vy=ny*0.1;}
function onUp(){joyCenter=null;joy.style.display="none";stick.style.transform="translate(0,0)";bird.vx=0;bird.vy=0;}
cvs.addEventListener("touchstart",onDown,{passive:false});cvs.addEventListener("touchmove",onMove,{passive:true});window.addEventListener("touchend",onUp,{passive:true});
cvs.addEventListener("mousedown",onDown);window.addEventListener("mousemove",onMove);window.addEventListener("mouseup",onUp);

const start=document.getElementById("start"),over=document.getElementById("gameover"),shop=document.getElementById("shop");
document.getElementById("playBtn").onclick=()=>{hideAll();reset();last=performance.now();requestAnimationFrame(loop);}
document.getElementById("goHome").onclick=()=>{hideAll();start.classList.add("show");}
document.getElementById("goShop").onclick=()=>{hideAll();showShop();}
document.getElementById("shopBack").onclick=()=>{hideAll();start.classList.add("show");}
document.querySelectorAll(".shop-btn").forEach(b=>b.onclick=()=>{buy(b.dataset.type);});

function hideAll(){start.classList.remove("show");over.classList.remove("show");shop.classList.remove("show");}
function reset(){state.running=true;state.paused=false;state.over=false;state.t=0;state.score=0;stars.length=0;bird.x=cvs.clientWidth/2;bird.y=cvs.clientHeight/2;}
function showShop(){document.getElementById("totalPoints").textContent=localStorage.points||0;shop.classList.add("show");}
function buy(type){let pts=parseInt(localStorage.points||0);if(type==="revive"&&pts>=1000){pts-=1000;alert("复活+1");}else if(type==="color"&&pts>=500){pts-=500;alert("换色");}else{alert("积分不足");return;}localStorage.points=pts;document.getElementById("totalPoints").textContent=pts;}

let last=performance.now();
function loop(now){if(!state.running)return;const dt=Math.min(50,now-last);last=now;if(state.paused)return;state.t+=dt;const newScore=Math.floor(state.t/1000);if(newScore!==state.score){state.score=newScore;document.getElementById("score").textContent=newScore;}
if(now-state.last>state.spawn){spawn();state.last=now;}
bird.x=clamp(bird.x+bird.vx,bird.r,cvs.clientWidth-bird.r);bird.y=clamp(bird.y+bird.vy,bird.r,cvs.clientHeight-bird.r);
ctx.clearRect(0,0,cvs.clientWidth,cvs.clientHeight);
for(let i=stars.length-1;i>=0;i--){const s=stars[i];s.y+=s.vy;s.rot+=s.spin;drawStar(s.x,s.y,s.size,s.rot);if(Math.hypot(s.x-bird.x,s.y-bird.y)<s.size+bird.r){hit();}if(s.y>cvs.clientHeight+40)stars.splice(i,1);}
drawBird();
if(state.running)requestAnimationFrame(loop);}
function hit(){state.running=false;const total=parseInt(localStorage.points||0)+state.score;localStorage.points=total;document.getElementById("final").textContent=state.score;setTimeout(()=>{over.classList.add("show");},100);}
</script>
</body>
</html>
更新：添加虚拟摇杆、全屏移动、积分商店
加入虚拟摇杆控制，小鸟可全屏移动，增加积分商店（复活、换色），游戏结束界面可返回主页或进入商店。
